<!DOCTYPE html>
<!-- saved from url=(0049)https://getbootstrap.com/docs/5.0/examples/cover/ -->
<html lang="en" class="h-100">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Nofelet</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/cover/">
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">
    <!-- Custom styles for this template -->
    <link href="./cover.css" rel="stylesheet">
</head>
<body class="d-flex h-100 text-center text-white bg-dark">
<div class="container text-center">
    <div class="row row-cols-2">
        <div class="col">
            <p  id="status-caller" class="fw-medium connection-status">Caller offline</p>
            <div class="card d-flex flex-column video-card " style="width: 40rem;">
                <video id="localVideo" autoplay muted playsinline></video>
            </div>
        </div>
        <div class="col">
            <p  id="status-callee" class="fw-medium connection-status">Callee offline</p>
            <div class="card d-flex flex-column video-card" style="width: 40rem;">
                <div class="video-box">
                    <video id="remoteVideo" autoplay muted playsinline></video>
                </div>
            </div>
        </div>
    </div>
    <div class="row row-cols-2">
        <div class="col btn-group mt-auto text-start p-3 w-25" role="group" aria-label="Default button group">
            <button onclick="startCall()" type="button" class="btn btn-light" id="startCallBtn" disabled>–ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
            <button onclick="disconnect()" type="button" class="btn btn-light" id="hangUpBtn" disabled>–û—Ç–±–æ–π</button>
            <button onclick="videoOff()" type="button" class="btn btn-light" id="videoToggle">
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í–∫–ª—é—á–µ–Ω–æ" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="videoOn" class="bi bi-camera-video" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1z"/>
                </svg>
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í—ã–∫–ª—é—á–µ–Ω–æ" (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="videoOff" class="bi bi-camera-video-off hidden" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M10.961 12.365a2 2 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272l.714 1H9.5a1 1 0 0 1 1 1v6a1 1 0 0 1-.144.518zM1.428 4.18A1 1 0 0 0 1 5v6a1 1 0 0 0 1 1h5.014l.714 1H2a2 2 0 0 1-2-2V5c0-.675.334-1.272.847-1.634zM15 11.73l-3.5-1.555v-4.35L15 4.269zm-4.407 3.56-10-14 .814-.58 10 14z"/>
                </svg>
            </button>
            <button onclick="soundOff()" type="button" class="btn btn-light" id="soundToggle">
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í–∫–ª—é—á–µ–Ω–æ" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="soundOn" class="bi bi-volume-down" viewBox="0 0 16 16">
                    <path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12zM6.312 6.39 8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11M12.025 8a4.5 4.5 0 0 1-1.318 3.182L10 10.475A3.5 3.5 0 0 0 11.025 8 3.5 3.5 0 0 0 10 5.525l.707-.707A4.5 4.5 0 0 1 12.025 8"/>
                </svg>
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í—ã–∫–ª—é—á–µ–Ω–æ" (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="soundOff" class="bi bi-volume-mute hidden" viewBox="0 0 16 16">
                    <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>
                </svg>
            </button>
        </div>
    </div>
    <div class="row">
        <div class="col-sm"></div>
        <div class="col-md-auto">
             <p id="invite"></p>
        </div>
        <div class="col-sm"></div>
    </div>
</div>
<script src="./menu.js"></script>

<!-- WebRTC –ª–æ–≥–∏–∫–∞-->
<script>
    let ws = null;
    let peerConnection = null;
    let localStream = null;
    let remoteStream = null;
    let iceCandidatesQueue = [];
    let answerTimeout = null;
    let answerWaitStartTime = null;
    let uuid = crypto.randomUUID();

    // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –° TURN –°–ï–†–í–ï–†–ê–ú–ò
    const configuration = {
        iceServers: [
            // STUN —Å–µ—Ä–≤–µ—Ä—ã
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:stun1.l.google.com:19302' },
            { urls: 'stun:stun2.l.google.com:19302' },
            { urls: 'stun:stun3.l.google.com:19302' },
            { urls: 'stun:stun4.l.google.com:19302' },

            // –ü—É–±–ª–∏—á–Ω—ã–µ TURN —Å–µ—Ä–≤–µ—Ä—ã (–≤–∞–∂–Ω–æ –¥–ª—è NAT)
            {
                urls: 'turn:openrelay.metered.ca:80',
                username: 'openrelayproject',
                credential: 'openrelayproject'
            },
            {
                urls: 'turn:openrelay.metered.ca:443',
                username: 'openrelayproject',
                credential: 'openrelayproject'
            },
            {
                urls: 'turn:openrelay.metered.ca:443?transport=tcp',
                username: 'openrelayproject',
                credential: 'openrelayproject'
            },
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ TURN —Å–µ—Ä–≤–µ—Ä—ã
            {
                urls: 'turn:turn.anyfirewall.com:443?transport=tcp',
                username: 'webrtc',
                credential: 'webrtc'
            }
        ],
        iceCandidatePoolSize: 10,
        iceTransportPolicy: 'all',
        bundlePolicy: 'max-bundle',
        rtcpMuxPolicy: 'require'
    };

    async function connect() {
        inviteUrl();

        try {
            ws = new WebSocket(`ws://localhost:8080/connect/${uuid}`);

            ws.onopen = () => {
                document.getElementById('startCallBtn').disabled = true;
                document.getElementById('videoOff').disabled = false;
                document.getElementById('soundOff').disabled = false;
                updateStatusCaller('Caller connected')
            };

            ws.onmessage = async (event) => {
                const message = JSON.parse(event.data);
                if (message.type === 'answer') {
                    console.log('system', 'Answer received from signaling, processing...');
                    await handleAnswer(message);
                } else if (message.type === 'ice-candidate') {
                    console.log('ice', 'Received ICE candidate from callee');
                    await handleIceCandidate(message.candidate);
                } else if (message.type === 'offer') {
                    console.log('system', 'Unexpected offer received - we are caller');
                } else if (message.type === 'clientExist'){
                    console.log('system', 'Callee connected');
                    document.getElementById('startCallBtn').disabled = false;
                    document.getElementById('hangUpBtn').disabled = false;
                }
            };

            ws.onerror = (error) => {
                console.log('Signaling error: ' + error);
            };

            ws.onclose = () => {
                console.log('Disconnected from signaling server');
                document.getElementById('startCallBtn').disabled = true;
            };
        } catch (error) {
            console.log('Signaling error: ' + error.message);
        }
    }

    async function startCall() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
            alert('First connect to signaling server!');
            return;
        }

        try {
            console.log('system', 'Starting call...');
            iceCandidatesQueue = []; // –û—á–∏—â–∞–µ–º –æ—á–µ—Ä–µ–¥—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤

            // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫
            localStream = await navigator.mediaDevices.getUserMedia({
                video: {
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    frameRate: { ideal: 30 }
                },
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true
                }
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
            document.getElementById('localVideo').srcObject = localStream;
            console.log('system', 'Local media stream acquired');

            // –°–æ–∑–¥–∞–µ–º PeerConnection
            peerConnection = new RTCPeerConnection(configuration);
            console.log('system', 'PeerConnection created with TURN servers');

            // –°–æ–∑–¥–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è remote video
            remoteStream = new MediaStream();
            document.getElementById('remoteVideo').srcObject = remoteStream;

            // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
                console.log('system', `Added local ${track.kind} track`);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
            peerConnection.ontrack = (event) => {
                console.log('system', `Remote track received: ${event.track.kind}`);

                // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–∫ –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫
                if (event.streams && event.streams[0]) {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ç–æ–∫ –∏–∑ —Å–æ–±—ã—Ç–∏—è
                    document.getElementById('remoteVideo').srcObject = event.streams[0];
                    console.log('system', `Set remote ${event.track.kind} stream`);
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫
                    remoteStream.addTrack(event.track);
                    console.log('system', `Added ${event.track.kind} track to remote stream`);
                }
            };

            // ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    const candidate = event.candidate;
                    console.log('ice', `ICE candidate: ${candidate.type} ${candidate.protocol} ${candidate.address}:${candidate.port}`);
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({
                            type: 'ice-candidate',
                            candidate: event.candidate
                        }));
                    }
                } else {
                    console.log('ice', 'All ICE candidates generated');
                }
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            peerConnection.onconnectionstatechange = () => {
                const state = peerConnection.connectionState;
                console.log('connection', `Connection state: ${state}`);

                if (state === 'connected') {
                    console.log('Call connected! ‚úÖ', 'connected');
                    document.getElementById('hangUpBtn').disabled = false;
                    document.getElementById('startCallBtn').disabled = true;
                    updateStatusCaller('Caller connected')
                } else if (state === 'disconnected' || state === 'failed') {
                    console.log(`Call ${state} ‚ùå`, 'disconnected');
                    document.getElementById('hangUpBtn').disabled = false;
                    document.getElementById('startCallBtn').disabled = false;
                    updateStatusCallee('Offline...')
                    if (state === 'failed') {
                        console.log('error', 'Connection failed - trying to restart ICE...');
                        setTimeout(() => {
                            if (peerConnection && peerConnection.connectionState === 'failed') {
                                peerConnection.restartIce();
                                console.log('system', 'ICE restart triggered');
                            }
                        }, 2000);
                    }
                } else if (state === 'connecting') {
                    console.log('Connecting... üîÑ', 'waiting');
                }
            };

            // ICE —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            peerConnection.oniceconnectionstatechange = () => {
                const state = peerConnection.iceConnectionState;
                console.log('ice', `ICE connection state: ${state}`);

                if (state === 'checking') {
                    console.log('system', 'ICE checking in progress...');
                } else if (state === 'connected') {
                    updateStatusCallee('Callee connected')
                    updateStatusCaller('Caller connected')
                    console.log('system', 'ICE connected successfully!');
                } else if (state === 'failed') {
                    console.log('error', 'ICE failed - check TURN servers');
                } else if (state === 'disconnected') {
                    console.log('warning', 'ICE disconnected - network issues?');
                }
            };

            // Signaling —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            peerConnection.onsignalingstatechange = () => {
                const state = peerConnection.signalingState;
                console.log('signaling', `Signaling state: ${state}`);

                if (state === 'stable') {
                    console.log('system', 'Signaling is stable');
                } else if (state === 'have-local-offer') {
                    console.log('system', 'Local offer set, waiting for answer');
                } else if (state === 'have-remote-offer') {
                    console.log('system', 'Remote offer received');
                }
            };

            // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º offer
            const offer = await peerConnection.createOffer({
                offerToReceiveAudio: true,
                offerToReceiveVideo: true,
                iceRestart: false
            });

            console.log('system', 'Offer created');

            await peerConnection.setLocalDescription(offer);
            console.log('system', 'Local description set');

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º offer —á–µ—Ä–µ–∑ signaling
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'offer',
                    sdp: offer.sdp
                }));
                console.log('system', 'Offer sent to signaling server');
            } else {
                console.log('error', 'WebSocket not connected, cannot send offer');
                return;
            }

            console.log('system', 'Waiting for answer from callee...');
            console.log('Waiting for answer... ‚è≥', 'waiting');
            document.getElementById('startCallBtn').disabled = true;

            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –æ–∂–∏–¥–∞–Ω–∏—è
            answerWaitStartTime = Date.now();

            // // –¢–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è answer
            // answerTimeout = setTimeout(() => {
            //     const elapsed = Math.round((Date.now() - answerWaitStartTime) / 1000);
            //     if (peerConnection && peerConnection.signalingState === 'have-local-offer') {
            //         console.log('error', `No answer received after ${elapsed} seconds - giving up`);
            //         console.log('system', 'Click "Hang Up" and try again');
            //         console.log('No answer received - call failed', 'disconnected');
            //         document.getElementById('startCallBtn').disabled = false;
            //     }
            // }, 30000);

        } catch (error) {
            console.log('error', 'Failed to start call: ' + error.message);
            console.log('Call failed', 'disconnected');
        }
    }

    async function handleAnswer(answer) {
        if (!peerConnection) {
            console.log('error', 'No PeerConnection when receiving answer');
            return;
        }

        try {
            console.log('system', 'Setting remote description (answer)...');
            await peerConnection.setRemoteDescription(answer);
            console.log('system', 'Remote description set successfully');

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
            if (iceCandidatesQueue.length > 0) {
                console.log('system', `Processing ${iceCandidatesQueue.length} queued ICE candidates`);
                for (const candidate of iceCandidatesQueue) {
                    try {
                        await peerConnection.addIceCandidate(candidate);
                        console.log('ice', 'Added queued ICE candidate');
                    } catch (err) {
                        console.log('error', 'Error adding queued candidate: ' + err.message);
                    }
                }
                iceCandidatesQueue = [];
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞
            document.getElementById('answerInput').value = JSON.stringify(answer);

        } catch (error) {
            console.log('error', 'Error setting answer: ' + error.message);
        }
    }

    async function handleIceCandidate(candidate) {
        if (!peerConnection) {
            console.log('error', 'No PeerConnection for ICE candidate - queuing');
            iceCandidatesQueue.push(candidate);
            return;
        }

        try {
            if (peerConnection.remoteDescription) {
                await peerConnection.addIceCandidate(candidate);
                console.log('ice', 'Added ICE candidate from callee');
            } else {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ remoteDescription
                iceCandidatesQueue.push(candidate);
                console.log('ice', `Queued ICE candidate (${iceCandidatesQueue.length} pending)`);
            }
        } catch (error) {
            console.log('error', 'Error adding ICE candidate: ' + error.message);
        }
    }

    function disconnect() {
        if (peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }

        if (localStream) {
            localStream.getTracks().forEach(track => track.stop());
            localStream = null;
        }

        if (remoteStream) {
            remoteStream.getTracks().forEach(track => track.stop());
            remoteStream = null;
        }

        document.getElementById('localVideo').srcObject = null;
        document.getElementById('remoteVideo').srcObject = null;
        iceCandidatesQueue = [];

        console.log('Call ended', 'disconnected');
        console.log('system', 'Call ended');
        console.log('state', 'All connections closed');

        document.getElementById('startCallBtn').disabled = true;
        document.getElementById('hangUpBtn').disabled = true;

        if (ws) {
            ws.close();
            ws = null;
        }
        console.log('Disconnected', 'disconnected');
        updateStatusCaller('Caller offline');
        updateStatusCallee('Callee offline')
    }

    function updateStatusCaller(message) {
        const status = document.getElementById('status-caller');
        status.textContent = message;
    }

    function updateStatusCallee(message){
        const status = document.getElementById('status-callee');
        status.textContent = message;
    }

    function videoOff(){
        const toggleButton = document.getElementById('videoToggle');
        const videoOffSVG = document.getElementById('videoOff');
        const videoOnSVG = document.getElementById('videoOn');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å 'hidden' —É –æ–±–æ–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        videoOffSVG.classList.toggle('hidden');
        videoOnSVG.classList.toggle('hidden');

        // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç aria-label –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        const isVideoOn = !videoOffSVG.classList.contains('hidden');
        if (isVideoOn){
            toggleButton.setAttribute('aria-label', '–í—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ');
            // document.getElementById('localVideo').srcObject = null;
            localStream.getVideoTracks().forEach(track => {
                track.enabled = false;
            });
            console.log('–í–∏–¥–µ–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É –ø–∏—Ä–∞.');
        }else {
            // document.getElementById('localVideo').srcObject = localStream;
            localStream.getVideoTracks().forEach(track => {
                track.enabled = true;
            });
            console.log('–í–∏–¥–µ–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É –ø–∏—Ä–∞.');
        }
    }

    function soundOff(){
        if (!localStream) return;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
        const audioTracks = localStream.getAudioTracks();
        if (audioTracks.length === 0) return;

        const currentState = audioTracks[0].enabled;
        const newState = !currentState;

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—Å–µ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏
        toggleAudio(localStream, newState);

        const soundOffSVG = document.getElementById('soundOff');
        const soundOnSVG = document.getElementById('soundOn');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å 'hidden' —É –æ–±–æ–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        soundOffSVG.classList.toggle('hidden');
        soundOnSVG.classList.toggle('hidden');
    }

    function toggleAudio(stream, enable) {
        if (!stream) return;

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏ –∏–∑ –ø–æ—Ç–æ–∫–∞
        const audioTracks = stream.getAudioTracks();

        // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∞–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º enabled
        audioTracks.forEach(track => {
            track.enabled = enable;
            console.log(`–ê—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∞ "${track.label}" —Ç–µ–ø–µ—Ä—å ${enable ? '–≤–∫–ª—é—á–µ–Ω–∞' : '–æ—Ç–∫–ª—é—á–µ–Ω–∞'}.`);
        });
    }

    function inviteUrl() {
        document.getElementById('invite').innerText = '–°—Å—ã–ª–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ ->  ' + `${window.location.origin}/Users/maxim/Documents/balun/callee.html?uuid=${uuid}`;
    }

    window.onload = connect;
</script>

</body>
</html>