<!DOCTYPE html>
<!-- saved from url=(0049)https://getbootstrap.com/docs/5.0/examples/cover/ -->
<html lang="en" class="h-100">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>Nofelet</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/cover/">
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon.ico">
    <meta name="theme-color" content="#7952b3">
    <!-- Custom styles for this template -->
    <link href="./cover.css" rel="stylesheet">
</head>
<body class="d-flex h-100 text-center text-white bg-dark">
<div class="container text-center">
    <div class="row row-cols-2">
        <div class="col">
            <p  id="status-caller" class="fw-medium connection-status">Callee offline</p>
            <div class="card d-flex flex-column video-card " style="width: 40rem;">
                <video id="localVideo" autoplay muted playsinline></video>
            </div>
        </div>
        <div class="col">
            <p  id="status-callee" class="fw-medium connection-status">Caller offline</p>
            <div class="card d-flex flex-column video-card" style="width: 40rem;">
                <div class="video-box">
                    <video id="remoteVideo" autoplay muted playsinline></video>
                </div>
            </div>
        </div>
    </div>
    <div class="row row-cols-2">
        <div class="col btn-group mt-auto text-start p-3 w-25" role="group" aria-label="Default button group">
            <button onclick="acceptCall()" class="btn btn-light" id="acceptCallBtn" disabled>–û—Ç–≤–µ—Ç–∏—Ç—å</button>
            <button onclick="disconnect()" type="button" class="btn btn-light" id="hangUpBtn" disabled>–û—Ç–±–æ–π</button>
            <button onclick="videoOff()" type="button" class="btn btn-light" id="videoToggle">
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í–∫–ª—é—á–µ–Ω–æ" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="videoOn" class="bi bi-camera-video" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1z"/>
                </svg>
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í—ã–∫–ª—é—á–µ–Ω–æ" (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="videoOff" class="bi bi-camera-video-off hidden" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M10.961 12.365a2 2 0 0 0 .522-1.103l3.11 1.382A1 1 0 0 0 16 11.731V4.269a1 1 0 0 0-1.406-.913l-3.111 1.382A2 2 0 0 0 9.5 3H4.272l.714 1H9.5a1 1 0 0 1 1 1v6a1 1 0 0 1-.144.518zM1.428 4.18A1 1 0 0 0 1 5v6a1 1 0 0 0 1 1h5.014l.714 1H2a2 2 0 0 1-2-2V5c0-.675.334-1.272.847-1.634zM15 11.73l-3.5-1.555v-4.35L15 4.269zm-4.407 3.56-10-14 .814-.58 10 14z"/>
                </svg>
            </button>
            <button onclick="soundOff()" type="button" class="btn btn-light" id="soundToggle">
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í–∫–ª—é—á–µ–Ω–æ" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="soundOn" class="bi bi-volume-down" viewBox="0 0 16 16">
                    <path d="M9 4a.5.5 0 0 0-.812-.39L5.825 5.5H3.5A.5.5 0 0 0 3 6v4a.5.5 0 0 0 .5.5h2.325l2.363 1.89A.5.5 0 0 0 9 12zM6.312 6.39 8 5.04v5.92L6.312 9.61A.5.5 0 0 0 6 9.5H4v-3h2a.5.5 0 0 0 .312-.11M12.025 8a4.5 4.5 0 0 1-1.318 3.182L10 10.475A3.5 3.5 0 0 0 11.025 8 3.5 3.5 0 0 0 10 5.525l.707-.707A4.5 4.5 0 0 1 12.025 8"/>
                </svg>
                <!-- SVG –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è "–í—ã–∫–ª—é—á–µ–Ω–æ" (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" id="soundOff" class="bi bi-volume-mute hidden" viewBox="0 0 16 16">
                    <path d="M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06M6 5.04 4.312 6.39A.5.5 0 0 1 4 6.5H2v3h2a.5.5 0 0 1 .312.11L6 10.96zm7.854.606a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0"/>
                </svg>
            </button>
        </div>
    </div>
</div>
<script src="./menu.js"></script>

<!-- WebRTC –ª–æ–≥–∏–∫–∞-->
<script>
    let ws = null;
    let peerConnection = null;
    let localStream = null;
    let remoteStream = null;
    let receivedOffer = null;
    let blinkIntervalId = null;
    let iceCandidatesQueue = [];
    let uuid = new URLSearchParams(window.location.search).get('uuid');

    // –¢–ê –ñ–ï –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –° TURN –°–ï–†–í–ï–†–ê–ú–ò
    const configuration = {
        iceCandidatePoolSize: 10,
        iceTransportPolicy: 'all',
        bundlePolicy: 'max-bundle',
        rtcpMuxPolicy: 'require'
    };

    function logConnectionStates() {
        if (peerConnection) {
            addMessage('state', `ICE: ${peerConnection.iceConnectionState}, Signaling: ${peerConnection.signalingState}, Connection: ${peerConnection.connectionState}`);
        }
    }

    async function connect() {
        try {
            ws = new WebSocket(`wss://nofelet.duckdns.org:8443/connect/${uuid}`);

            ws.onopen = () => {
                updateStatus('Connected to signaling server', 'connected');
                addMessage('system', 'Connected to signaling server');
            };

            ws.onmessage = async (event) => {
                const message = JSON.parse(event.data);
                addMessage('signaling', `Received: ${message.type}`);

                if (message.type === 'offer') {
                    receivedOffer = message;
                    startBlinkingButton('acceptCallBtn', 500);
                    document.getElementById('acceptCallBtn').disabled = false;
                    document.getElementById('hangUpBtn').disabled = false;
                    updateStatus('Incoming call... Click Accept', 'waiting');
                    addMessage('system', 'Offer received from caller');
                } else if (message.type === 'ice-candidate') {
                    addMessage('ice', 'Received ICE candidate from caller');
                    await handleIceCandidate(message.candidate);
                } else if (message.type === 'answer') {
                    addMessage('system', 'Unexpected answer received - we are callee');
                }
            };

            ws.onerror = (error) => {
                updateStatus('Signaling error', 'disconnected');
                addMessage('system', 'Signaling error: ' + error);
            };

            ws.onclose = (event) => {
                updateStatus('Disconnected from signaling', 'disconnected');
                addMessage('system', 'Disconnected from signaling server');
                console.log('Code:', event.code);
                console.log('Reason:', event.reason);
                console.log('Was clean?', event.wasClean);
                document.getElementById('acceptCallBtn').disabled = true;
                document.getElementById('hangUpBtn').disabled = false;
            };
        } catch (error) {
            addMessage('error', 'Connection error: ' + error.message);
        }
    }

    async function acceptCall() {
        clearInterval(blinkIntervalId);

        try {
            // 1. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –¥–æ–∂–∏–¥–∞–µ–º—Å—è –ø–æ–ª—É—á–µ–Ω–∏—è –ö–†–ï–î–ï–ù–¶–ò–ê–õ–û–í TURN
            console.log('system', 'Fetching CoTURN credentials...');
            const turnServers = await getCoTURNCredentialsAsync();

            // 2. –û–ë–ù–û–í–õ–Ø–ï–ú –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º PeerConnection
            configuration.iceServers = turnServers;
            console.log('system', 'Configuration updated with fresh TURN credentials');

            // 3. –°–æ–∑–¥–∞–µ–º PeerConnection (—Ç–µ–ø–µ—Ä—å —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–æ–π)
            peerConnection = new RTCPeerConnection(configuration);
        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ TURN –∫—Ä–µ–¥–æ–≤ –∏–ª–∏ —Å—Ç–∞—Ä—Ç–µ –∑–≤–æ–Ω–∫–∞:", error);
        }

        try {
            addMessage('system', 'Accepting call...');
            iceCandidatesQueue = [];

            // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞–ø–æ—Ç–æ–∫
            localStream = await navigator.mediaDevices.getUserMedia({
                video: {
                    width: { ideal: 640 },
                    height: { ideal: 480 },
                    frameRate: { ideal: 30 }
                },
                audio: {
                    echoCancellation: true,
                    noiseSuppression: true
                }
            });

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤–∏–¥–µ–æ
            document.getElementById('localVideo').srcObject = localStream;
            addMessage('system', 'Local media stream acquired');

            // –ò–¥–µ–º –∑–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∫—Ä–µ–¥–∞–º–∏ CoTURN
            // await getCoTURNCredentials();

            // –°–æ–∑–¥–∞–µ–º PeerConnection
            peerConnection = new RTCPeerConnection(configuration);
            addMessage('system', 'PeerConnection created with TURN servers');
            logConnectionStates();

            // –°–æ–∑–¥–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è remote video
            remoteStream = new MediaStream();
            document.getElementById('remoteVideo').srcObject = remoteStream;

            // –î–æ–±–∞–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–∫–∏
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
                addMessage('system', `Added local ${track.kind} track`);
            });

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤
            peerConnection.ontrack = (event) => {
                addMessage('system', `Remote track received: ${event.track.kind}`);

                if (event.streams && event.streams[0]) {
                    document.getElementById('remoteVideo').srcObject = event.streams[0];
                    addMessage('system', `Set remote ${event.track.kind} stream`);
                } else {
                    remoteStream.addTrack(event.track);
                    addMessage('system', `Added ${event.track.kind} track to remote stream`);
                }
            };

            // ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    const candidate = event.candidate;
                    addMessage('ice', `ICE candidate: ${candidate.type} ${candidate.protocol} ${candidate.address}:${candidate.port}`);

                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({
                            type: 'ice-candidate',
                            candidate: event.candidate
                        }));
                    }
                } else {
                    addMessage('ice', 'All ICE candidates generated');
                }
            };

            // –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            peerConnection.onconnectionstatechange = () => {
                const state = peerConnection.connectionState;
                addMessage('connection', `Connection state: ${state}`);
                logConnectionStates();

                if (state === 'connected') {
                    updateStatus('Call connected! ‚úÖ', 'connected');
                    document.getElementById('hangUpBtn').disabled = false;
                    document.getElementById('acceptCallBtn').disabled = true;
                } else if (state === 'disconnected' || state === 'failed') {
                    updateStatus(`Call ${state} ‚ùå`, 'disconnected');
                    document.getElementById('hangUpBtn').disabled = false;
                    document.getElementById('acceptCallBtn').disabled = false;
                } else if (state === 'connecting') {
                    updateStatus('Connecting... üîÑ', 'waiting');
                }
            };

            // ICE —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            peerConnection.oniceconnectionstatechange = () => {
                const state = peerConnection.iceConnectionState;
                addMessage('ice', `ICE connection state: ${state}`);
                logConnectionStates();
            };

            // Signaling —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            peerConnection.onsignalingstatechange = () => {
                const state = peerConnection.signalingState;
                addMessage('signaling', `Signaling state: ${state}`);
                logConnectionStates();

                if (state === 'stable') {
                    addMessage('system', 'Signaling is stable');
                } else if (state === 'have-remote-offer') {
                    addMessage('system', 'Remote offer received, creating answer');
                } else if (state === 'have-local-pranswer') {
                    addMessage('system', 'Preliminary answer created');
                }
            };

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–¥–∞–ª–µ–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (offer)
            addMessage('system', 'Setting remote description (offer)...');
            await peerConnection.setRemoteDescription(receivedOffer);
            addMessage('system', 'Remote description set');
            logConnectionStates();

            // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç—ã
            if (iceCandidatesQueue.length > 0) {
                addMessage('system', `Processing ${iceCandidatesQueue.length} queued ICE candidates`);
                for (const candidate of iceCandidatesQueue) {
                    try {
                        await peerConnection.addIceCandidate(candidate);
                        addMessage('ice', 'Added queued ICE candidate');
                    } catch (err) {
                        addMessage('error', 'Error adding queued candidate: ' + err.message);
                    }
                }
                iceCandidatesQueue = [];
            }

            // –°–æ–∑–¥–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º answer
            const answer = await peerConnection.createAnswer({
                offerToReceiveAudio: true,
                offerToReceiveVideo: true
            });
            addMessage('system', 'Answer created');

            await peerConnection.setLocalDescription(answer);
            addMessage('system', 'Local description set');
            logConnectionStates();

            peerConnection.onicegatheringstatechange = () => {
                if (peerConnection.iceGatheringState === 'complete') {
                    // –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å SDP offer/answer —É–¥–∞–ª–µ–Ω–Ω–æ–º—É –ø–∏—Ä—É
                    console.log('system', 'IceGatheringState - complete');
                }
            };

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º answer —á–µ—Ä–µ–∑ signaling
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'answer',
                    sdp: answer.sdp
                }));
                addMessage('system', 'Answer sent to signaling server');
            } else {
                addMessage('warning', 'WebSocket not connected - answer not sent via signaling');
                addMessage('system', 'Copy this answer and send it to caller manually:');
                addMessage('system', JSON.stringify(answer));
            }

            updateStatus('Call accepted! ‚úÖ', 'connected');
            document.getElementById('acceptCallBtn').disabled = true;

        } catch (error) {
            addMessage('error', 'Failed to accept call: ' + error.message);
            updateStatus('Call failed', 'disconnected');
        }
    }

    async function handleIceCandidate(candidate) {
        if (!peerConnection) {
            addMessage('error', 'No PeerConnection for ICE candidate - queuing');
            iceCandidatesQueue.push(candidate);
            return;
        }

        try {
            if (peerConnection.remoteDescription) {
                await peerConnection.addIceCandidate(candidate);
                addMessage('ice', 'Added ICE candidate from caller');
            } else {
                iceCandidatesQueue.push(candidate);
                addMessage('ice', `Queued ICE candidate (${iceCandidatesQueue.length} pending)`);
            }
        } catch (error) {
            addMessage('error', 'Error adding ICE candidate: ' + error.message);
        }
    }

    function disconnect() {
        if (peerConnection) {
            peerConnection.close();
            peerConnection = null;
        }

        if (localStream) {
            localStream.getTracks().forEach(track => track.stop());
            localStream = null;
        }

        if (remoteStream) {
            remoteStream.getTracks().forEach(track => track.stop());
            remoteStream = null;
        }

        document.getElementById('localVideo').srcObject = null;
        document.getElementById('remoteVideo').srcObject = null;
        receivedOffer = null;
        iceCandidatesQueue = [];

        updateStatus('Call ended', 'disconnected');
        addMessage('system', 'Call ended');
        addMessage('state', 'All connections closed');

        document.getElementById('acceptCallBtn').disabled = true;
        document.getElementById('hangUpBtn').disabled = false;

        const button = document.getElementById('acceptCallBtn');
        button.style.backgroundColor = 'white';
        button.style.color = 'black'; // –î–µ–ª–∞–µ–º —Ç–µ–∫—Å—Ç —á–µ—Ä–Ω—ã–º –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞

        if (ws) ws.close(1000, "Signaling complete");
        updateStatus('Disconnected', 'disconnected');
    }

    function updateStatus(message, type) {
        console.log(message, type)
    }

    function addMessage(type, message) {
        console.log(message, type)
    }

    function videoOff(){
        const toggleButton = document.getElementById('videoToggle');
        const videoOffSVG = document.getElementById('videoOff');
        const videoOnSVG = document.getElementById('videoOn');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å 'hidden' —É –æ–±–æ–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        videoOffSVG.classList.toggle('hidden');
        videoOnSVG.classList.toggle('hidden');

        // –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç—å –∞—Ç—Ä–∏–±—É—Ç aria-label –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        const isVideoOn = !videoOffSVG.classList.contains('hidden');
        if (isVideoOn){
            toggleButton.setAttribute('aria-label', '–í—ã–∫–ª—é—á–∏—Ç—å –≤–∏–¥–µ–æ');
            localStream.getVideoTracks().forEach(track => {
                track.enabled = false;
            });
            console.log('–í–∏–¥–µ–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É –ø–∏—Ä–∞.');
        }else {
            localStream.getVideoTracks().forEach(track => {
                track.enabled = true;
            });
            console.log('–í–∏–¥–µ–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É –ø–∏—Ä–∞.');
        }
    }

    function soundOff(){
        if (!localStream) return;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–≤–æ–π –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏ (–µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å)
        const audioTracks = localStream.getAudioTracks();
        if (audioTracks.length === 0) return;

        const currentState = audioTracks[0].enabled;
        const newState = !currentState;

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—Å–µ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏
        toggleAudio(localStream, newState);

        const soundOffSVG = document.getElementById('soundOff');
        const soundOnSVG = document.getElementById('soundOn');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∫–ª–∞—Å—Å 'hidden' —É –æ–±–æ–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        soundOffSVG.classList.toggle('hidden');
        soundOnSVG.classList.toggle('hidden');
    }

    function toggleAudio(stream, enable) {
        if (!stream) return;

        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∏ –∏–∑ –ø–æ—Ç–æ–∫–∞
        const audioTracks = stream.getAudioTracks();

        // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∞—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∞–º –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º enabled
        audioTracks.forEach(track => {
            track.enabled = enable;
            console.log(`–ê—É–¥–∏–æ–¥–æ—Ä–æ–∂–∫–∞ "${track.label}" —Ç–µ–ø–µ—Ä—å ${enable ? '–≤–∫–ª—é—á–µ–Ω–∞' : '–æ—Ç–∫–ª—é—á–µ–Ω–∞'}.`);
        });
    }

    function startBlinkingButton(buttonId, intervalTime = 500) {
        const button = document.getElementById(buttonId);

        if (!button) {
            console.error('–ö–Ω–æ–ø–∫–∞ —Å ID ' + buttonId + ' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.');
            return;
        }

        // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–ø—É—â–µ–Ω
        if (blinkIntervalId) {
            clearInterval(blinkIntervalId);
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
        blinkIntervalId = setInterval(() => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π —Ü–≤–µ—Ç –∏ –º–µ–Ω—è–µ–º –µ–≥–æ
            if (button.style.backgroundColor === 'blue') {
                button.style.backgroundColor = 'white';
                button.style.color = 'black'; // –î–µ–ª–∞–µ–º —Ç–µ–∫—Å—Ç —á–µ—Ä–Ω—ã–º –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
            } else {
                button.style.backgroundColor = 'blue';
                button.style.color = 'white'; // –î–µ–ª–∞–µ–º —Ç–µ–∫—Å—Ç –±–µ–ª—ã–º –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞
            }
        }, intervalTime);
    }

    // –ü–µ—Ä–µ–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã –æ–Ω–∞ —Å—Ç–∞–ª–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ Promise
    function getCoTURNCredentialsAsync() {
        return new Promise((resolve, reject) => {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ –∫–æ–¥, –Ω–æ –º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É –æ–±—Ä–∞–±–æ—Ç–∫–∏
                const wsTurn = new WebSocket(`wss://nofelet.duckdns.org:8443/turn-credentials/generate`);

                wsTurn.onopen = () => {
                    console.log('Connected to TURN signaling server');
                };

                wsTurn.onmessage = (event) => {
                    const creds = JSON.parse(event.data);
                    // –ö–∞–∫ —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, —Ä–µ–∑–æ–ª–≤–∏–º –ø—Ä–æ–º–∏—Å —Å –Ω–æ–≤—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏
                    resolve(creds.iceServers);
                    wsTurn.close(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–µ–¥–æ–≤
                };

                wsTurn.onerror = (error) => {
                    console.error('Signaling error: ' + error);
                    reject(error); // –û—Ç–∫–ª–æ–Ω—è–µ–º –ø—Ä–æ–º–∏—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                };

                wsTurn.onclose = (event) => {
                    console.log('Disconnected from TURN signaling server');
                };
            } catch (error) {
                reject(error);
            }
        });
    }

    window.onload = connect;
</script>

</body>
</html>