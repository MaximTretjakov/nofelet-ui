(function(){"use strict";var e={1065:function(e,t,n){var a=n(5130),o=n(6768);const r={id:"app"},c={class:"main-content"};function i(e,t,n,a,i,s){const l=(0,o.g2)("Header"),d=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",r,[(0,o.bF)(l),(0,o.Lk)("main",c,[(0,o.bF)(d)])])}const s={class:"header"},l={key:0,class:"logo"},d={key:1,class:"logo-placeholder"};function u(e,t,n,a,r,c){return(0,o.uX)(),(0,o.CE)("header",s,["/"!==e.$route.path?((0,o.uX)(),(0,o.CE)("div",l," nofelet ")):((0,o.uX)(),(0,o.CE)("div",d))])}var f={name:"Header"},v=n(1241);const m=(0,v.A)(f,[["render",u],["__scopeId","data-v-44094c99"]]);var g=m,p={name:"App",components:{Header:g}};const y=(0,v.A)(p,[["render",i]]);var h=y,k=n(8512),C=(n(4114),n(8111),n(7588),n(4603),n(7566),n(8721),n(4232)),b=n(144);const w={class:"call-container"},S={class:"controls-group"},E=["disabled"],$=["disabled"],L=["disabled"],O={class:"video-container"},R={class:"video-box"},A={class:"video-box"},N={class:"debug-panel"},P={class:"debug-section"},T={key:0,class:"messages"},j={class:"call-link"},I=["href"],x={class:"debug-section"},D={key:0,class:"manual-fallback"};var _={__name:"Call",setup(e){const t=(0,b.KR)(null),n=(0,b.KR)(""),r=(0,b.KR)(!1),c=(0,b.KR)(!1),i=(0,b.KR)(!1),s=(0,b.KR)("Disconnected"),l=(0,b.KR)("disconnected"),d=(0,b.KR)([]),u=(0,b.KR)(!1),f=(0,b.KR)(!1),v=(0,b.KR)(null),m=(0,b.KR)(null),g=(0,b.KR)(""),p=(0,b.KR)("");let y=null,h=null,k=null,_=null,U=[],K=null;const W=(0,o.EW)(()=>"hash"===router.history._history.location?`https://maximtretjakov.github.io/nofelet-ui/#/call/?uuid=${n.value}`:`https://maximtretjakov.github.io/nofelet-ui/call/?uuid=${n.value}`),J=(0,o.EW)(()=>d.value.slice(-20)),q={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function M(e,t){const n=(new Date).toLocaleTimeString(),a={type:e,text:`[${n}] ${t}`};d.value.push(a),d.value.length>100&&d.value.shift()}function F(e,t){s.value=e,l.value=t,M("status",e)}function V(){u.value=!u.value}function X(){f.value=!f.value}function H(){y&&M("state",`ICE: ${y.iceConnectionState}, Signaling: ${y.signalingState}, Connection: ${y.connectionState}`)}function B(){K&&(clearTimeout(K),K=null)}function Q(){navigator.clipboard.writeText(W.value).then(()=>{M("system","Call link copied to clipboard!")}).catch(e=>{M("error","Failed to copy call link: "+e)})}function z(){try{const e=`wss://nofelet.duckdns.org:8443/connect/${n.value}`;M("system",`Auto-connecting to signaling server: ${e}`),M("system",`Call link: ${W.value}`),t.value=new WebSocket(e),t.value.onopen=()=>{r.value=!0,F("Connected to signaling server âœ…","connected"),M("system","WebSocket connection established")},t.value.onmessage=async e=>{try{const t=JSON.parse(e.data);M("signaling",`Received: ${t.type}`),"offer"===t.type?(_=t,i.value=!0,g.value=JSON.stringify(t),F("Incoming call... Click Accept","waiting"),M("system","Offer received from caller - ready to accept call")):"answer"===t.type?(M("system","Answer received from callee, processing..."),B(),await Z(t)):"ice-candidate"===t.type&&(M("ice","Received ICE candidate from peer"),await te(t.candidate))}catch(t){M("error",`Message parsing error: ${t.message}`)}},t.value.onerror=e=>{F("Signaling error âŒ","disconnected"),M("error",`WebSocket error: ${e}`)},t.value.onclose=()=>{r.value=!1,i.value=!1,c.value=!1,F("Disconnected from signaling server","disconnected"),M("system","WebSocket connection closed")}}catch(e){M("error",`Connection failed: ${e.message}`)}}async function Y(){if(t.value&&t.value.readyState===WebSocket.OPEN)try{M("system","Starting call as caller..."),c.value=!0,i.value=!1,U=[],B(),h=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0}}),v.value.srcObject=h,M("system","Local media stream acquired"),y=new RTCPeerConnection(q),M("system","PeerConnection created with TURN servers"),H(),k=new MediaStream,m.value.srcObject=k,h.getTracks().forEach(e=>{y.addTrack(e,h),M("system",`Added local ${e.kind} track`)}),y.ontrack=e=>{M("system",`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?(m.value.srcObject=e.streams[0],M("system",`Set remote ${e.track.kind} stream`)):(k.addTrack(e.track),M("system",`Added ${e.track.kind} track to remote stream`))},y.onicecandidate=e=>{if(e.candidate){const n=e.candidate;M("ice",`ICE candidate: ${n.type} ${n.protocol} ${n.address}:${n.port}`),t.value&&t.value.readyState===WebSocket.OPEN&&t.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))}else M("ice","All ICE candidates generated")},y.onconnectionstatechange=()=>{const e=y.connectionState;M("connection",`Connection state: ${e}`),H(),"connected"===e?(F("Call connected! âœ…","connected"),B()):"disconnected"===e||"failed"===e?(F(`Call ${e} âŒ`,"disconnected"),c.value=!1):"connecting"===e&&F("Connecting... ðŸ”„","waiting")},y.oniceconnectionstatechange=()=>{const e=y.iceConnectionState;M("ice",`ICE connection state: ${e}`),H()},y.onsignalingstatechange=()=>{const e=y.signalingState;M("signaling",`Signaling state: ${e}`),H()};const e=await y.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!1});if(M("system","Offer created"),await y.setLocalDescription(e),M("system","Local description set"),H(),!t.value||t.value.readyState!==WebSocket.OPEN)return void M("error","WebSocket not connected, cannot send offer");t.value.send(JSON.stringify({type:"offer",sdp:e.sdp})),M("system","Offer sent to signaling server"),M("system","Waiting for answer from callee..."),F("Waiting for answer... â³","waiting"),K=setTimeout(()=>{y&&"have-local-offer"===y.signalingState&&(M("warning","No answer received after 30 seconds"),M("system","You can manually paste the answer SDP above"))},3e4)}catch(e){M("error",`Failed to start call: ${e.message}`),F("Call failed","disconnected"),c.value=!1,B()}else alert("Not connected to signaling server!")}async function G(){if(!_){const t=g.value.trim();if(!t)return void alert("No offer received yet! Check signaling connection or paste offer manually.");try{_=JSON.parse(t),M("system","Using manual offer from textarea")}catch(e){return void alert("Invalid offer format in textarea")}}try{if(M("system","Accepting call as callee..."),c.value=!0,U=[],h=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0}}),v.value.srcObject=h,M("system","Local media stream acquired"),y=new RTCPeerConnection(q),M("system","PeerConnection created with TURN servers"),H(),k=new MediaStream,m.value.srcObject=k,h.getTracks().forEach(e=>{y.addTrack(e,h),M("system",`Added local ${e.kind} track`)}),y.ontrack=e=>{M("system",`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?(m.value.srcObject=e.streams[0],M("system",`Set remote ${e.track.kind} stream`)):(k.addTrack(e.track),M("system",`Added ${e.track.kind} track to remote stream`))},y.onicecandidate=e=>{if(e.candidate){const n=e.candidate;M("ice",`ICE candidate: ${n.type} ${n.protocol} ${n.address}:${n.port}`),t.value&&t.value.readyState===WebSocket.OPEN&&t.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))}else M("ice","All ICE candidates generated")},y.onconnectionstatechange=()=>{const e=y.connectionState;M("connection",`Connection state: ${e}`),H(),"connected"===e?F("Call connected! âœ…","connected"):"disconnected"===e||"failed"===e?(F(`Call ${e} âŒ`,"disconnected"),c.value=!1):"connecting"===e&&F("Connecting... ðŸ”„","waiting")},M("system","Setting remote description (offer)..."),await y.setRemoteDescription(_),M("system","Remote description set"),H(),U.length>0){M("system",`Processing ${U.length} queued ICE candidates`);for(const e of U)try{await y.addIceCandidate(e),M("ice","Added queued ICE candidate")}catch(n){M("error",`Error adding queued candidate: ${n.message}`)}U=[]}const e=await y.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});M("system","Answer created"),await y.setLocalDescription(e),M("system","Local description set"),H(),t.value&&t.value.readyState===WebSocket.OPEN?(t.value.send(JSON.stringify({type:"answer",sdp:e.sdp})),M("system","Answer sent to signaling server"),p.value=JSON.stringify(e)):(M("warning","WebSocket not connected - answer not sent via signaling"),M("system","Copy this answer and send it to caller manually:"),p.value=JSON.stringify(e)),F("Call accepted! âœ…","connected"),i.value=!1}catch(a){M("error",`Failed to accept call: ${a.message}`),F("Call failed","disconnected"),c.value=!1,i.value=!1}}async function Z(e){if(y)try{if(M("system","Setting remote description (answer)..."),await y.setRemoteDescription(e),M("system","Remote description set successfully"),H(),U.length>0){M("system",`Processing ${U.length} queued ICE candidates`);for(const e of U)try{await y.addIceCandidate(e),M("ice","Added queued ICE candidate")}catch(t){M("error",`Error adding queued candidate: ${t.message}`)}U=[]}p.value=JSON.stringify(e)}catch(n){M("error",`Error setting answer: ${n.message}`)}else M("error","No PeerConnection when receiving answer")}async function ee(){const e=p.value;if(e)try{const t=JSON.parse(e);M("system","Setting manual answer..."),await Z(t)}catch(t){M("error",`Invalid answer format: ${t.message}`)}else alert("Paste answer SDP first!")}async function te(e){if(!y)return M("error","No PeerConnection for ICE candidate - queuing"),void U.push(e);try{y.remoteDescription?(await y.addIceCandidate(e),M("ice","Added ICE candidate from peer")):(U.push(e),M("ice",`Queued ICE candidate (${U.length} pending)`))}catch(t){M("error",`Error adding ICE candidate: ${t.message}`)}}function ne(){M("system","Hanging up..."),y&&(y.close(),y=null),h&&(h.getTracks().forEach(e=>e.stop()),h=null),k&&(k.getTracks().forEach(e=>e.stop()),k=null),v.value.srcObject=null,m.value.srcObject=null,c.value=!1,i.value=!1,_=null,U=[],B(),F("Call ended","disconnected"),M("system","Call ended")}return(0,o.sV)(()=>{M("system","Component mounted");const e=new URLSearchParams(window.location.search),t=e.get("uuid");t?(n.value=t,M("system",`UUID from URL: ${n.value}`)):(n.value=crypto.randomUUID(),M("system",`New UUID generated: ${n.value}`)),z()}),(e,t)=>((0,o.uX)(),(0,o.CE)("div",w,[t[5]||(t[5]=(0,o.Lk)("h1",null,"WebRTC Video Call",-1)),(0,o.Lk)("div",{class:(0,C.C4)(["status",l.value])},(0,C.v_)(s.value),3),(0,o.Lk)("div",S,[(0,o.Lk)("button",{onClick:Y,disabled:!r.value||c.value},"Start Call",8,E),(0,o.Lk)("button",{onClick:G,disabled:!r.value||!i.value||c.value,class:"accept-btn"}," Accept Call ",8,$),(0,o.Lk)("button",{onClick:ne,disabled:!c.value,class:"hangup-btn"},"Hang Up",8,L)]),(0,o.Lk)("div",O,[(0,o.Lk)("div",R,[t[2]||(t[2]=(0,o.Lk)("h3",null,"Local Video",-1)),(0,o.Lk)("video",{ref_key:"localVideo",ref:v,autoplay:"",muted:"",playsinline:""},null,512)]),(0,o.Lk)("div",A,[t[3]||(t[3]=(0,o.Lk)("h3",null,"Remote Video",-1)),(0,o.Lk)("video",{ref_key:"remoteVideo",ref:m,autoplay:"",playsinline:""},null,512)])]),(0,o.Lk)("div",N,[(0,o.Lk)("div",P,[(0,o.Lk)("h4",{onClick:V},"Signaling Messages â–¼"),u.value?((0,o.uX)(),(0,o.CE)("div",T,[(0,o.Lk)("div",j,[t[4]||(t[4]=(0,o.Lk)("strong",null,"Call Link:",-1)),(0,o.Lk)("a",{href:W.value,target:"_blank"},(0,C.v_)(W.value),9,I),(0,o.Lk)("button",{onClick:Q,class:"small-btn copy-btn"},"Copy")]),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(J.value,(e,t)=>((0,o.uX)(),(0,o.CE)("div",{key:t,class:(0,C.C4)(e.type)},(0,C.v_)(e.text),3))),128))])):(0,o.Q3)("",!0)]),(0,o.Lk)("div",x,[(0,o.Lk)("h4",{onClick:X},"Manual SDP â–¼"),f.value?((0,o.uX)(),(0,o.CE)("div",D,[(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),placeholder:"Offer SDP...",class:"compact-textarea"},null,512),[[a.Jo,g.value]]),(0,o.Lk)("button",{onClick:G,class:"small-btn"},"Use Offer")]),(0,o.Lk)("div",null,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>p.value=e),placeholder:"Answer SDP...",class:"compact-textarea"},null,512),[[a.Jo,p.value]]),(0,o.Lk)("button",{onClick:ee,class:"small-btn"},"Use Answer")])])):(0,o.Q3)("",!0)])])]))}};const U=(0,v.A)(_,[["__scopeId","data-v-548f4064"]]);var K=U;const W=[{path:"/",name:"Home",component:()=>n.e(236).then(n.bind(n,2236))},{path:"/call/",name:"Call",component:K}],J=(0,k.aE)({history:(0,k.Bt)(),routes:W});var q=J;console.log("ðŸ”§ Router instance:",q);const M=(0,a.Ef)(h);M.use(q),M.mount("#app"),console.log("âœ… App mounted")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,r){if(!a){var c=1/0;for(d=0;d<e.length;d++){a=e[d][0],o=e[d][1],r=e[d][2];for(var i=!0,s=0;s<a.length;s++)(!1&r||c>=r)&&Object.keys(n.O).every(function(e){return n.O[e](a[s])})?a.splice(s--,1):(i=!1,r<c&&(c=r));if(i){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,o,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce(function(t,a){return n.f[a](e,t),t},[]))}}(),function(){n.u=function(e){return"static/js/"+e+".c3c09c61.js"}}(),function(){n.miniCssF=function(e){return"static/css/"+e+".acec16c5.css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="nofelet:";n.l=function(a,o,r,c){if(e[a])e[a].push(o);else{var i,s;if(void 0!==r)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+r){i=u;break}}i||(s=!0,i=document.createElement("script"),i.charset="utf-8",n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",t+r),i.src=a),e[a]=[o];var f=function(t,n){i.onerror=i.onload=null,clearTimeout(v);var o=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach(function(e){return e(n)}),t)return t(n)},v=setTimeout(f.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=f.bind(null,i.onerror),i.onload=f.bind(null,i.onload),s&&document.head.appendChild(i)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/nofelet-ui/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,o,r){var c=document.createElement("link");c.rel="stylesheet",c.type="text/css",n.nc&&(c.nonce=n.nc);var i=function(n){if(c.onerror=c.onload=null,"load"===n.type)o();else{var a=n&&n.type,i=n&&n.target&&n.target.href||t,s=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+i+")");s.name="ChunkLoadError",s.code="CSS_CHUNK_LOAD_FAILED",s.type=a,s.request=i,c.parentNode&&c.parentNode.removeChild(c),r(s)}};return c.onerror=c.onload=i,c.href=t,a?a.parentNode.insertBefore(c,a.nextSibling):document.head.appendChild(c),c},t=function(e,t){for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var o=n[a],r=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(r===e||r===t))return o}var c=document.getElementsByTagName("style");for(a=0;a<c.length;a++){o=c[a],r=o.getAttribute("data-href");if(r===e||r===t)return o}},a=function(a){return new Promise(function(o,r){var c=n.miniCssF(a),i=n.p+c;if(t(c,i))return o();e(a,i,null,o,r)})},o={524:0};n.f.miniCss=function(e,t){var n={236:1};o[e]?t.push(o[e]):0!==o[e]&&n[e]&&t.push(o[e]=a(e).then(function(){o[e]=0},function(t){throw delete o[e],t}))}}}(),function(){var e={524:0};n.f.j=function(t,a){var o=n.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else{var r=new Promise(function(n,a){o=e[t]=[n,a]});a.push(o[2]=r);var c=n.p+n.u(t),i=new Error,s=function(a){if(n.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var r=a&&("load"===a.type?"missing":a.type),c=a&&a.target&&a.target.src;i.message="Loading chunk "+t+" failed.\n("+r+": "+c+")",i.name="ChunkLoadError",i.type=r,i.request=c,o[1](i)}};n.l(c,s,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,r,c=a[0],i=a[1],s=a[2],l=0;if(c.some(function(t){return 0!==e[t]})){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(s)var d=s(n)}for(t&&t(a);l<c.length;l++)r=c[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},a=self["webpackChunknofelet"]=self["webpackChunknofelet"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],function(){return n(1065)});a=n.O(a)})();
//# sourceMappingURL=app.b8192a39.js.map