(function(){"use strict";var e={616:function(e,t,a){var n=a(5130),c=a(6768);const o={id:"app"},l={class:"main-content"};function s(e,t,a,n,s,i){const r=(0,c.g2)("Header"),d=(0,c.g2)("router-view");return(0,c.uX)(),(0,c.CE)("div",o,[(0,c.bF)(r),(0,c.Lk)("main",l,[(0,c.bF)(d)])])}const i={class:"header"},r={key:0,class:"logo"},d={key:1,class:"logo-placeholder"};function u(e,t,a,n,o,l){return(0,c.uX)(),(0,c.CE)("header",i,["/"!==e.$route.path?((0,c.uX)(),(0,c.CE)("div",r," nofelet ")):((0,c.uX)(),(0,c.CE)("div",d))])}var v={name:"Header"},p=a(1241);const m=(0,p.A)(v,[["render",u],["__scopeId","data-v-44094c99"]]);var g=m,f={name:"App",components:{Header:g}};const y=(0,p.A)(f,[["render",s]]);var k=y,C=a(8512);const h={class:"home"},b={class:"logo-section"},w={class:"call-types-section",ref:"callTypesSection"},S={class:"call-type-block p2p-block"};function L(e,t,a,n,o,l){return(0,c.uX)(),(0,c.CE)("div",h,[(0,c.Lk)("div",b,[t[3]||(t[3]=(0,c.Lk)("div",{class:"center-logo"}," nofelet ",-1)),(0,c.Lk)("div",{class:"scroll-indicator",onClick:t[0]||(t[0]=(...e)=>l.scrollToCallTypes&&l.scrollToCallTypes(...e))},[...t[2]||(t[2]=[(0,c.Lk)("div",{class:"arrow"},null,-1)])])]),(0,c.Lk)("div",w,[(0,c.Lk)("div",S,[t[4]||(t[4]=(0,c.Lk)("h2",{class:"call-type-title"},"P2P",-1)),t[5]||(t[5]=(0,c.Lk)("p",{class:"call-type-description"}," person to person ‚Ä¢ –≤ –∑–≤–æ–Ω–∫–µ —É—á–∞—Å—Ç–≤—É—é—Ç –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö —á–µ–ª–æ–≤–µ–∫ ",-1)),t[6]||(t[6]=(0,c.Lk)("div",{class:"beta-badge"},"beta",-1)),(0,c.Lk)("button",{class:"start-btn",onClick:t[1]||(t[1]=(...e)=>l.startP2PCall&&l.startP2PCall(...e))}," start ")]),t[7]||(t[7]=(0,c.Fv)('<div class="call-type-block conference-block disabled" data-v-0e1d1f43><h2 class="call-type-title" data-v-0e1d1f43>Conference</h2><p class="call-type-description" data-v-0e1d1f43> –∑–≤–æ–Ω–æ–∫ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è<br data-v-0e1d1f43> –≤ –∑–≤–æ–Ω–∫–µ —É—á–∞—Å—Ç–≤—É—é—Ç –±–æ–ª–µ–µ 2 —á–µ–ª–æ–≤–µ–∫ </p><div class="progress-badge" data-v-0e1d1f43>in progress</div><button class="start-btn disabled" disabled data-v-0e1d1f43> start </button></div>',1))],512)])}a(4114);var $={name:"Home",methods:{scrollToCallTypes(){this.$refs.callTypesSection.scrollIntoView({behavior:"smooth"})},startP2PCall(){this.$router.push("/call")}}};const R=(0,p.A)($,[["render",L],["__scopeId","data-v-0e1d1f43"]]);var E=R,I=(a(8111),a(7588),a(4603),a(7566),a(8721),a(4232)),O=a(144);const T={class:"call-container"},U={class:"uuid-input-section"},P={class:"controls-group"},D=["disabled"],A=["disabled"],j=["disabled"],N=["disabled"],x=["disabled"],K={class:"video-container"},_={class:"video-box"},W={class:"video-box"},V={class:"debug-panel"},J={class:"debug-section"},M={key:0,class:"messages"},q={class:"call-link"},F=["href"],X={class:"debug-section"},H={key:0,class:"manual-fallback"};var Q={__name:"Call",setup(e){const t=(0,O.KR)(null),a=((0,C.lq)(),(0,O.KR)("")),o=(0,c.EW)(()=>{if(a.value.trim())return a.value.trim();const e=new URLSearchParams(window.location.search),t=e.get("uuid");return t||crypto.randomUUID()}),l=(0,O.KR)(!1),s=(0,O.KR)(!1),i=(0,O.KR)(!1),r=(0,O.KR)("Disconnected"),d=(0,O.KR)("disconnected"),u=(0,O.KR)([]),v=(0,O.KR)(!1),p=(0,O.KR)(!1),m=(0,O.KR)(null),g=(0,O.KR)(null),f=(0,O.KR)(""),y=(0,O.KR)("");let k=null,h=null,b=null,w=null,S=[],L=null;const $=(0,c.EW)(()=>`https://maximtretjakov.github.io/nofelet-ui/call/?uuid=${o.value}`),R=(0,c.EW)(()=>u.value.slice(-20)),E={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function Q(e,t){const a=(new Date).toLocaleTimeString(),n={type:e,text:`[${a}] ${t}`};u.value.push(n),u.value.length>100&&u.value.shift()}function z(e,t){r.value=e,d.value=t,Q("status",e)}function Y(){v.value=!v.value}function B(){p.value=!p.value}function G(){k&&Q("state",`ICE: ${k.iceConnectionState}, Signaling: ${k.signalingState}, Connection: ${k.connectionState}`)}function Z(){L&&(clearTimeout(L),L=null)}function ee(){a.value.trim()?(Q("system",`–ü—Ä–∏–º–µ–Ω–µ–Ω —Ä—É—á–Ω–æ–π UUID: ${a.value.trim()}`),z("UUID –ø—Ä–∏–º–µ–Ω–µ–Ω. –ù–∞–∂–º–∏—Ç–µ Connect –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è","waiting"),l.value&&(ne(),setTimeout(()=>ae(),500))):alert("–í–≤–µ–¥–∏—Ç–µ UUID –≤ –ø–æ–ª–µ –≤—ã—à–µ")}function te(){navigator.clipboard.writeText($.value).then(()=>{Q("system","Call link copied to clipboard!")}).catch(e=>{Q("error","Failed to copy call link: "+e)})}function ae(){try{const e=`wss://nofelet.duckdns.org:8443/connect/${o.value}`;Q("system",`Connecting to signaling server: ${e}`),Q("system",`Call link: ${$.value}`);const n=new URLSearchParams(window.location.search),c=n.get("uuid");Q("system",`Using UUID: ${o.value} ${c?"(from invitation link)":a.value?"(manual input)":"(newly generated)"}`),t.value=new WebSocket(e),t.value.onopen=()=>{l.value=!0,z("Connected to signaling server ‚úÖ","connected"),Q("system","WebSocket connection established")},t.value.onmessage=async e=>{try{const t=JSON.parse(e.data);Q("signaling",`Received: ${t.type}`),"offer"===t.type?(w=t,i.value=!0,f.value=JSON.stringify(t),z("Incoming call... Click Accept","waiting"),Q("system","Offer received from caller - ready to accept call")):"answer"===t.type?(Q("system","Answer received from callee, processing..."),Z(),await le(t)):"ice-candidate"===t.type&&(Q("ice","Received ICE candidate from peer"),await ie(t.candidate))}catch(t){Q("error",`Message parsing error: ${t.message}`)}},t.value.onerror=e=>{z("Signaling error ‚ùå","disconnected"),Q("error",`WebSocket error: ${e}`)},t.value.onclose=()=>{l.value=!1,i.value=!1,s.value=!1,z("Disconnected from signaling server","disconnected"),Q("system","WebSocket connection closed")}}catch(e){Q("error",`Connection failed: ${e.message}`)}}function ne(){t.value&&(t.value.close(),t.value=null),re()}async function ce(){if(t.value&&t.value.readyState===WebSocket.OPEN)try{Q("system","Starting call as caller..."),s.value=!0,i.value=!1,S=[],Z(),h=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0}}),m.value.srcObject=h,Q("system","Local media stream acquired"),k=new RTCPeerConnection(E),Q("system","PeerConnection created with TURN servers"),G(),b=new MediaStream,g.value.srcObject=b,h.getTracks().forEach(e=>{k.addTrack(e,h),Q("system",`Added local ${e.kind} track`)}),k.ontrack=e=>{Q("system",`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?(g.value.srcObject=e.streams[0],Q("system",`Set remote ${e.track.kind} stream`)):(b.addTrack(e.track),Q("system",`Added ${e.track.kind} track to remote stream`))},k.onicecandidate=e=>{if(e.candidate){const a=e.candidate;Q("ice",`ICE candidate: ${a.type} ${a.protocol} ${a.address}:${a.port}`),t.value&&t.value.readyState===WebSocket.OPEN&&t.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))}else Q("ice","All ICE candidates generated")},k.onconnectionstatechange=()=>{const e=k.connectionState;Q("connection",`Connection state: ${e}`),G(),"connected"===e?(z("Call connected! ‚úÖ","connected"),Z()):"disconnected"===e||"failed"===e?(z(`Call ${e} ‚ùå`,"disconnected"),s.value=!1):"connecting"===e&&z("Connecting... üîÑ","waiting")},k.oniceconnectionstatechange=()=>{const e=k.iceConnectionState;Q("ice",`ICE connection state: ${e}`),G()},k.onsignalingstatechange=()=>{const e=k.signalingState;Q("signaling",`Signaling state: ${e}`),G()};const e=await k.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0,iceRestart:!1});if(Q("system","Offer created"),await k.setLocalDescription(e),Q("system","Local description set"),G(),!t.value||t.value.readyState!==WebSocket.OPEN)return void Q("error","WebSocket not connected, cannot send offer");t.value.send(JSON.stringify({type:"offer",sdp:e.sdp})),Q("system","Offer sent to signaling server"),Q("system","Waiting for answer from callee..."),z("Waiting for answer... ‚è≥","waiting"),L=setTimeout(()=>{k&&"have-local-offer"===k.signalingState&&(Q("warning","No answer received after 30 seconds"),Q("system","You can manually paste the answer SDP above"))},3e4)}catch(e){Q("error",`Failed to start call: ${e.message}`),z("Call failed","disconnected"),s.value=!1,Z()}else alert("First connect to signaling server!")}async function oe(){if(!w){const t=f.value.trim();if(!t)return void alert("No offer received yet! Check signaling connection or paste offer manually.");try{w=JSON.parse(t),Q("system","Using manual offer from textarea")}catch(e){return void alert("Invalid offer format in textarea")}}try{if(Q("system","Accepting call as callee..."),s.value=!0,S=[],h=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0}}),m.value.srcObject=h,Q("system","Local media stream acquired"),k=new RTCPeerConnection(E),Q("system","PeerConnection created with TURN servers"),G(),b=new MediaStream,g.value.srcObject=b,h.getTracks().forEach(e=>{k.addTrack(e,h),Q("system",`Added local ${e.kind} track`)}),k.ontrack=e=>{Q("system",`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?(g.value.srcObject=e.streams[0],Q("system",`Set remote ${e.track.kind} stream`)):(b.addTrack(e.track),Q("system",`Added ${e.track.kind} track to remote stream`))},k.onicecandidate=e=>{if(e.candidate){const a=e.candidate;Q("ice",`ICE candidate: ${a.type} ${a.protocol} ${a.address}:${a.port}`),t.value&&t.value.readyState===WebSocket.OPEN&&t.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))}else Q("ice","All ICE candidates generated")},k.onconnectionstatechange=()=>{const e=k.connectionState;Q("connection",`Connection state: ${e}`),G(),"connected"===e?z("Call connected! ‚úÖ","connected"):"disconnected"===e||"failed"===e?(z(`Call ${e} ‚ùå', 'disconnected`),s.value=!1):"connecting"===e&&z("Connecting... üîÑ","waiting")},Q("system","Setting remote description (offer)..."),await k.setRemoteDescription(w),Q("system","Remote description set"),G(),S.length>0){Q("system",`Processing ${S.length} queued ICE candidates`);for(const e of S)try{await k.addIceCandidate(e),Q("ice","Added queued ICE candidate")}catch(a){Q("error",`Error adding queued candidate: ${a.message}`)}S=[]}const e=await k.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});Q("system","Answer created"),await k.setLocalDescription(e),Q("system","Local description set"),G(),t.value&&t.value.readyState===WebSocket.OPEN?(t.value.send(JSON.stringify({type:"answer",sdp:e.sdp})),Q("system","Answer sent to signaling server"),y.value=JSON.stringify(e)):(Q("warning","WebSocket not connected - answer not sent via signaling"),Q("system","Copy this answer and send it to caller manually:"),y.value=JSON.stringify(e)),z("Call accepted! ‚úÖ","connected"),i.value=!1}catch(n){Q("error",`Failed to accept call: ${n.message}`),z("Call failed","disconnected"),s.value=!1,i.value=!1}}async function le(e){if(k)try{if(Q("system","Setting remote description (answer)..."),await k.setRemoteDescription(e),Q("system","Remote description set successfully"),G(),S.length>0){Q("system",`Processing ${S.length} queued ICE candidates`);for(const e of S)try{await k.addIceCandidate(e),Q("ice","Added queued ICE candidate")}catch(t){Q("error",`Error adding queued candidate: ${t.message}`)}S=[]}y.value=JSON.stringify(e)}catch(a){Q("error",`Error setting answer: ${a.message}`)}else Q("error","No PeerConnection when receiving answer")}async function se(){const e=y.value;if(e)try{const t=JSON.parse(e);Q("system","Setting manual answer..."),await le(t)}catch(t){Q("error",`Invalid answer format: ${t.message}`)}else alert("Paste answer SDP first!")}async function ie(e){if(!k)return Q("error","No PeerConnection for ICE candidate - queuing"),void S.push(e);try{k.remoteDescription?(await k.addIceCandidate(e),Q("ice","Added ICE candidate from peer")):(S.push(e),Q("ice",`Queued ICE candidate (${S.length} pending)`))}catch(t){Q("error",`Error adding ICE candidate: ${t.message}`)}}function re(){Q("system","Hanging up..."),k&&(k.close(),k=null),h&&(h.getTracks().forEach(e=>e.stop()),h=null),b&&(b.getTracks().forEach(e=>e.stop()),b=null),m.value.srcObject=null,g.value.srcObject=null,s.value=!1,i.value=!1,w=null,S=[],Z(),z("Call ended","disconnected"),Q("system","Call ended")}return(0,c.sV)(()=>{Q("system",`Component mounted ‚Üí UUID: ${o.value}`),Q("system",`Call link: ${$.value}`);const e=new URLSearchParams(window.location.search),t=e.get("uuid");Q("system","UUID source: "+(t?"from invitation link":a.value?"manual input":"newly generated"))}),(0,c.xo)(()=>{ne(),Q("system","Component unmounted")}),(e,t)=>((0,c.uX)(),(0,c.CE)("div",T,[t[7]||(t[7]=(0,c.Lk)("h1",null,"WebRTC Video Call",-1)),(0,c.Lk)("div",{class:(0,I.C4)(["status",d.value])},(0,I.v_)(r.value),3),(0,c.Lk)("div",U,[t[3]||(t[3]=(0,c.Lk)("label",{for:"uuid-input"},"UUID –∑–≤–æ–Ω–∫–∞:",-1)),(0,c.bo)((0,c.Lk)("input",{id:"uuid-input",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),placeholder:"–í–≤–µ–¥–∏—Ç–µ UUID –∑–≤–æ–Ω–∫–∞...",class:"uuid-input"},null,512),[[n.Jo,a.value]]),(0,c.Lk)("button",{onClick:ee,class:"apply-uuid-btn"},"–ü—Ä–∏–º–µ–Ω–∏—Ç—å UUID")]),(0,c.Lk)("div",P,[(0,c.Lk)("button",{onClick:ae,disabled:l.value},"Connect",8,D),(0,c.Lk)("button",{onClick:ce,disabled:!l.value||s.value},"Start Call",8,A),(0,c.Lk)("button",{onClick:oe,disabled:!l.value||!i.value||s.value,class:"accept-btn"}," Accept Call ",8,j),(0,c.Lk)("button",{onClick:re,disabled:!s.value,class:"hangup-btn"},"Hang Up",8,N),(0,c.Lk)("button",{onClick:ne,disabled:!l.value},"Disconnect",8,x)]),(0,c.Lk)("div",K,[(0,c.Lk)("div",_,[t[4]||(t[4]=(0,c.Lk)("h3",null,"Local Video",-1)),(0,c.Lk)("video",{ref_key:"localVideo",ref:m,autoplay:"",muted:"",playsinline:""},null,512)]),(0,c.Lk)("div",W,[t[5]||(t[5]=(0,c.Lk)("h3",null,"Remote Video",-1)),(0,c.Lk)("video",{ref_key:"remoteVideo",ref:g,autoplay:"",playsinline:""},null,512)])]),(0,c.Lk)("div",V,[(0,c.Lk)("div",J,[(0,c.Lk)("h4",{onClick:Y},"Signaling Messages ‚ñº"),v.value?((0,c.uX)(),(0,c.CE)("div",M,[(0,c.Lk)("div",q,[t[6]||(t[6]=(0,c.Lk)("strong",null,"Call Link:",-1)),(0,c.Lk)("a",{href:$.value,target:"_blank"},(0,I.v_)($.value),9,F),(0,c.Lk)("button",{onClick:te,class:"small-btn copy-btn"},"Copy")]),((0,c.uX)(!0),(0,c.CE)(c.FK,null,(0,c.pI)(R.value,(e,t)=>((0,c.uX)(),(0,c.CE)("div",{key:t,class:(0,I.C4)(e.type)},(0,I.v_)(e.text),3))),128))])):(0,c.Q3)("",!0)]),(0,c.Lk)("div",X,[(0,c.Lk)("h4",{onClick:B},"Manual SDP ‚ñº"),p.value?((0,c.uX)(),(0,c.CE)("div",H,[(0,c.Lk)("div",null,[(0,c.bo)((0,c.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),placeholder:"Offer SDP...",class:"compact-textarea"},null,512),[[n.Jo,f.value]]),(0,c.Lk)("button",{onClick:oe,class:"small-btn"},"Use Offer")]),(0,c.Lk)("div",null,[(0,c.bo)((0,c.Lk)("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>y.value=e),placeholder:"Answer SDP...",class:"compact-textarea"},null,512),[[n.Jo,y.value]]),(0,c.Lk)("button",{onClick:se,class:"small-btn"},"Use Answer")])])):(0,c.Q3)("",!0)])])]))}};const z=(0,p.A)(Q,[["__scopeId","data-v-01184354"]]);var Y=z;a(2489);const B={class:"call-container"},G={class:"buttons"},Z=["disabled"],ee=["disabled"],te={class:"video-container"},ae={class:"video-box"},ne={class:"video-box"},ce={class:"messages"},oe={class:"log-window"};var le={__name:"CallReceiver",setup(e){const t=(0,O.KR)(null),a=crypto.randomUUID(),n=(0,O.KR)(!1),o=(0,O.KR)(!1),l=(0,O.KR)(!1),s=(0,O.KR)("Disconnected"),i=(0,O.KR)("disconnected"),r=(0,O.KR)([]),d=(0,O.KR)(null),u=(0,O.KR)(null);let v=null,p=null,m=null,g=null,f=[];const y={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function k(e){const t=(new Date).toLocaleTimeString(),a=`[${t}] ${e}`;console.log("%c[WebRTC Receiver]","color:#28a745",e),r.value.push(a),r.value.length>500&&r.value.shift()}function C(e,t){s.value=e,i.value=t,k(`STATUS ‚Üí ${e}`)}function h(){const e=`ws://localhost:8080/connect/${a}`;k(`Connecting to signaling server: ${e}`),t.value=new WebSocket(e),t.value.onopen=()=>{n.value=!0,C("Connected to signaling server ‚úÖ","connected")},t.value.onmessage=async e=>{const t=JSON.parse(e.data);k(`Received: ${t.type}`),"offer"===t.type?(g=t,l.value=!0,C("Incoming call... üìû","waiting")):"ice-candidate"===t.type&&await w(t.candidate)},t.value.onclose=()=>{n.value=!1,C("Disconnected from signaling server","disconnected")},t.value.onerror=e=>{C("Signaling error ‚ùå","disconnected"),k(`WebSocket error: ${e.message}`)}}async function b(){if(g)try{k("Accepting call..."),o.value=!0,f=[];const n=await navigator.mediaDevices.enumerateDevices(),c=n.filter(e=>"videoinput"===e.kind),s=n.filter(e=>"audioinput"===e.kind);k(`Detected devices: ${c.length} cameras, ${s.length} microphones`);try{p=await navigator.mediaDevices.getUserMedia({video:!!c.length&&{width:{ideal:640},height:{ideal:480}},audio:!!s.length&&{echoCancellation:!0,noiseSuppression:!0}}),k("Local media stream acquired")}catch(e){k(`Primary getUserMedia failed (${e.name}): ${e.message}`);try{p=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),k("Fallback media stream acquired (basic config)")}catch(a){throw k(`Fallback getUserMedia failed (${a.name}): ${a.message}`),C("Media access failed ‚ùå","disconnected"),o.value=!1,a}}if(d.value.srcObject=p,v=new RTCPeerConnection(y),m=new MediaStream,u.value.srcObject=m,p.getTracks().forEach(e=>{v.addTrack(e,p),k(`Added local ${e.kind} track`)}),v.ontrack=e=>{k(`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?u.value.srcObject=e.streams[0]:m.addTrack(e.track)},v.onicecandidate=e=>{e.candidate?(k(`ICE candidate: ${e.candidate.protocol}`),t.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))):k("All ICE candidates sent")},v.onconnectionstatechange=()=>{k(`Connection state: ${v.connectionState}`),"connected"===v.connectionState?C("Call connected ‚úÖ","connected"):["failed","disconnected","closed"].includes(v.connectionState)&&(C(`Call ended (${v.connectionState})`,"disconnected"),o.value=!1)},k("Setting remote description (offer)..."),await v.setRemoteDescription(g),k("Remote description set"),f.length>0){k(`Processing ${f.length} queued ICE candidates`);for(const e of f)await v.addIceCandidate(e);f=[]}const i=await v.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});await v.setLocalDescription(i),t.value.send(JSON.stringify({type:"answer",sdp:i.sdp})),k("Answer sent to caller"),C("Call accepted ‚úÖ","connected"),l.value=!1}catch(e){k(`Failed to accept call: ${e.message}`),C("Call failed ‚ùå","disconnected"),o.value=!1}else alert("No offer received yet!")}async function w(e){if(v)try{v.remoteDescription?(await v.addIceCandidate(e),k("Added ICE candidate")):(f.push(e),k("Queued ICE candidate (remote not ready)"))}catch(t){k(`ICE candidate error: ${t.message}`)}else k("No PeerConnection for ICE candidate")}function S(){k("Hanging up..."),v&&v.close(),v=null,p&&(p.getTracks().forEach(e=>e.stop()),p=null),m&&(m.getTracks().forEach(e=>e.stop()),m=null),o.value=!1,g=null,f=[],C("Call ended","disconnected")}return(0,c.sV)(()=>{k(`Receiver mounted ‚Üí UUID: ${a}`),h()}),(0,c.xo)(()=>{S(),t.value&&t.value.close(),k("Receiver unmounted")}),(e,t)=>((0,c.uX)(),(0,c.CE)("div",B,[t[3]||(t[3]=(0,c.Lk)("h1",null,"WebRTC Video Receiver",-1)),(0,c.Lk)("div",{class:(0,I.C4)(["status",i.value])},(0,I.v_)(s.value),3),(0,c.Lk)("div",G,[(0,c.Lk)("button",{onClick:b,disabled:!l.value||o.value},"Accept Call",8,Z),(0,c.Lk)("button",{onClick:S,disabled:!o.value},"Hang Up",8,ee)]),(0,c.Lk)("div",te,[(0,c.Lk)("div",ae,[t[0]||(t[0]=(0,c.Lk)("h3",null,"Local Video",-1)),(0,c.Lk)("video",{ref_key:"localVideo",ref:d,autoplay:"",muted:"",playsinline:""},null,512)]),(0,c.Lk)("div",ne,[t[1]||(t[1]=(0,c.Lk)("h3",null,"Remote Video",-1)),(0,c.Lk)("video",{ref_key:"remoteVideo",ref:u,autoplay:"",playsinline:""},null,512)])]),(0,c.Lk)("div",ce,[t[2]||(t[2]=(0,c.Lk)("h3",null,"Debug Log",-1)),(0,c.Lk)("div",oe,[((0,c.uX)(!0),(0,c.CE)(c.FK,null,(0,c.pI)(r.value,(e,t)=>((0,c.uX)(),(0,c.CE)("div",{key:t},(0,I.v_)(e),1))),128))])])]))}};const se=(0,p.A)(le,[["__scopeId","data-v-7876a68a"]]);var ie=se;const re=[{path:"/",name:"Home",component:E},{path:"/call",name:"Call",component:Y},{path:"/callee",name:"Callee",component:ie}],de=(0,C.aE)({history:(0,C.LA)("/nofelet-ui/"),routes:re});var ue=de;console.log("üîß Router instance:",ue);const ve=(0,n.Ef)(k);ve.use(ue),ve.mount("#app"),console.log("‚úÖ App mounted")}},t={};function a(n){var c=t[n];if(void 0!==c)return c.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,n,c,o){if(!n){var l=1/0;for(d=0;d<e.length;d++){n=e[d][0],c=e[d][1],o=e[d][2];for(var s=!0,i=0;i<n.length;i++)(!1&o||l>=o)&&Object.keys(a.O).every(function(e){return a.O[e](n[i])})?n.splice(i--,1):(s=!1,o<l&&(l=o));if(s){e.splice(d--,1);var r=c();void 0!==r&&(t=r)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,c,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var c,o,l=n[0],s=n[1],i=n[2],r=0;if(l.some(function(t){return 0!==e[t]})){for(c in s)a.o(s,c)&&(a.m[c]=s[c]);if(i)var d=i(a)}for(t&&t(n);r<l.length;r++)o=l[r],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},n=self["webpackChunknofelet"]=self["webpackChunknofelet"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[504],function(){return a(616)});n=a.O(n)})();
//# sourceMappingURL=app.1c758ea2.js.map