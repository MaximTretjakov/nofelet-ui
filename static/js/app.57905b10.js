(function(){"use strict";var e={1262:function(e,n,a){var t=a(5130),o=a(6768);const c={id:"app"},l={class:"main-content"};function i(e,n,a,t,i,r){const s=(0,o.g2)("Header"),d=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",c,[(0,o.bF)(s),(0,o.Lk)("main",l,[(0,o.bF)(d)])])}const r={class:"header"},s={key:0,class:"logo"},d={key:1,class:"logo-placeholder"};function u(e,n,a,t,c,l){return(0,o.uX)(),(0,o.CE)("header",r,["/"!==e.$route.path?((0,o.uX)(),(0,o.CE)("div",s," nofelet ")):((0,o.uX)(),(0,o.CE)("div",d))])}var v={name:"Header"},p=a(1241);const f=(0,p.A)(v,[["render",u],["__scopeId","data-v-44094c99"]]);var g=f,m={name:"App",components:{Header:g}};const y=(0,p.A)(m,[["render",i]]);var k=y,C=a(8512);const h={class:"home"},b={class:"logo-section"},w={class:"call-types-section",ref:"callTypesSection"},L={class:"call-type-block p2p-block"};function R(e,n,a,t,c,l){return(0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",b,[n[3]||(n[3]=(0,o.Lk)("div",{class:"center-logo"}," nofelet ",-1)),(0,o.Lk)("div",{class:"scroll-indicator",onClick:n[0]||(n[0]=(...e)=>l.scrollToCallTypes&&l.scrollToCallTypes(...e))},[...n[2]||(n[2]=[(0,o.Lk)("div",{class:"arrow"},null,-1)])])]),(0,o.Lk)("div",w,[(0,o.Lk)("div",L,[n[4]||(n[4]=(0,o.Lk)("h2",{class:"call-type-title"},"P2P",-1)),n[5]||(n[5]=(0,o.Lk)("p",{class:"call-type-description"}," person to person ‚Ä¢ –≤ –∑–≤–æ–Ω–∫–µ —É—á–∞—Å—Ç–≤—É—é—Ç –Ω–µ –±–æ–ª–µ–µ –¥–≤—É—Ö —á–µ–ª–æ–≤–µ–∫ ",-1)),n[6]||(n[6]=(0,o.Lk)("div",{class:"beta-badge"},"beta",-1)),(0,o.Lk)("button",{class:"start-btn",onClick:n[1]||(n[1]=(...e)=>l.startP2PCall&&l.startP2PCall(...e))}," start ")]),n[7]||(n[7]=(0,o.Fv)('<div class="call-type-block conference-block disabled" data-v-0e1d1f43><h2 class="call-type-title" data-v-0e1d1f43>Conference</h2><p class="call-type-description" data-v-0e1d1f43> –∑–≤–æ–Ω–æ–∫ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è<br data-v-0e1d1f43> –≤ –∑–≤–æ–Ω–∫–µ —É—á–∞—Å—Ç–≤—É—é—Ç –±–æ–ª–µ–µ 2 —á–µ–ª–æ–≤–µ–∫ </p><div class="progress-badge" data-v-0e1d1f43>in progress</div><button class="start-btn disabled" disabled data-v-0e1d1f43> start </button></div>',1))],512)])}a(4114);var S={name:"Home",methods:{scrollToCallTypes(){this.$refs.callTypesSection.scrollIntoView({behavior:"smooth"})},startP2PCall(){this.$router.push("/call")}}};const $=(0,p.A)(S,[["render",R],["__scopeId","data-v-0e1d1f43"]]);var T=$,E=(a(8111),a(7588),a(4232)),I=a(144);const O={class:"call-container"},P={class:"buttons"},j=["disabled"],D=["disabled"],A={class:"video-container"},_={class:"video-box"},K={class:"video-box"},U={class:"messages"},x={class:"log-window"};var V={__name:"Call",setup(e){const n=(0,I.KR)(null),a=crypto.randomUUID(),t=(0,I.KR)(!1),c=(0,I.KR)(!1),l=(0,I.KR)("Disconnected"),i=(0,I.KR)("disconnected"),r=(0,I.KR)([]),s=(0,I.KR)(null),d=(0,I.KR)(null);let u=null,v=null,p=null,f=[];const g={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function m(e){const n=(new Date).toLocaleTimeString(),a=`[${n}] ${e}`;console.log("%c[WebRTC]","color: #0af",e),r.value.push(a),r.value.length>500&&r.value.shift()}function y(e,n){l.value=e,i.value=n,m(`STATUS ‚Üí ${e}`)}function k(){try{const e=`ws://localhost:8080/connect/${a}`;m(`Connecting to signaling server: ${e}`),n.value=new WebSocket(e),n.value.onopen=()=>{t.value=!0,y("Connected to signaling server ‚úÖ","connected")},n.value.onmessage=async e=>{const n=JSON.parse(e.data);m(`Received: ${n.type}`),"answer"===n.type?await h(n):"ice-candidate"===n.type&&await b(n.candidate)},n.value.onerror=e=>{y("Signaling error ‚ùå","disconnected"),m(`WebSocket error: ${e.message}`)},n.value.onclose=()=>{t.value=!1,y("Disconnected from signaling server","disconnected")}}catch(e){m(`WS connection failed: ${e.message}`)}}async function C(){if(n.value&&n.value.readyState===WebSocket.OPEN)try{m("Starting call..."),c.value=!0,f=[],v=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:640},height:{ideal:480},frameRate:{ideal:30}},audio:{echoCancellation:!0,noiseSuppression:!0}}),s.value.srcObject=v,m("Local stream acquired"),u=new RTCPeerConnection(g),p=new MediaStream,d.value.srcObject=p,v.getTracks().forEach(e=>{u.addTrack(e,v),m(`Added local ${e.kind} track`)}),u.ontrack=e=>{m(`Remote track: ${e.track.kind}`),e.streams&&e.streams[0]?d.value.srcObject=e.streams[0]:p.addTrack(e.track)},u.onicecandidate=e=>{e.candidate?(m(`ICE candidate: ${e.candidate.protocol}`),n.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))):m("All ICE candidates sent")},u.onconnectionstatechange=()=>{m(`Connection state: ${u.connectionState}`),"connected"===u.connectionState?y("Call connected! ‚úÖ","connected"):["failed","disconnected","closed"].includes(u.connectionState)&&(y(`Call ended (${u.connectionState})`,"disconnected"),c.value=!1)};const e=await u.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});await u.setLocalDescription(e),n.value.send(JSON.stringify({type:"offer",sdp:e.sdp})),m("Offer sent to callee"),y("Waiting for answer ‚è≥","waiting")}catch(e){m(`Error starting call: ${e.message}`),y("Call failed ‚ùå","disconnected"),c.value=!1}else alert("Connect to signaling first!")}async function h(e){if(u)try{if(m("Setting remote description (answer)..."),await u.setRemoteDescription(e),m("Remote description set successfully"),f.length>0){m(`Processing ${f.length} queued ICE candidates`);for(const e of f)await u.addIceCandidate(e);f=[]}y("Call established ‚úÖ","connected")}catch(n){m(`Error applying answer: ${n.message}`)}else m("No peerConnection for answer")}async function b(e){if(u)try{u.remoteDescription?(await u.addIceCandidate(e),m("Added ICE candidate")):(f.push(e),m("Queued ICE candidate (remote not ready)"))}catch(n){m(`ICE candidate error: ${n.message}`)}else m("No peerConnection for ICE")}function w(){m("Hanging up..."),u&&u.close(),u=null,v&&(v.getTracks().forEach(e=>e.stop()),v=null),p&&(p.getTracks().forEach(e=>e.stop()),p=null),c.value=!1,y("Call ended","disconnected")}return(0,o.sV)(()=>{m(`Component mounted ‚Üí UUID: ${a}`),k()}),(0,o.xo)(()=>{w(),n.value&&n.value.close(),m("Component unmounted")}),(e,n)=>((0,o.uX)(),(0,o.CE)("div",O,[n[3]||(n[3]=(0,o.Lk)("h1",null,"WebRTC Video Call",-1)),(0,o.Lk)("div",{class:(0,E.C4)(["status",i.value])},(0,E.v_)(l.value),3),(0,o.Lk)("div",P,[(0,o.Lk)("button",{onClick:C,disabled:!t.value||c.value},"Start Call",8,j),(0,o.Lk)("button",{onClick:w,disabled:!c.value},"Hang Up",8,D)]),(0,o.Lk)("div",A,[(0,o.Lk)("div",_,[n[0]||(n[0]=(0,o.Lk)("h3",null,"Local Video",-1)),(0,o.Lk)("video",{ref_key:"localVideo",ref:s,autoplay:"",muted:"",playsinline:""},null,512)]),(0,o.Lk)("div",K,[n[1]||(n[1]=(0,o.Lk)("h3",null,"Remote Video",-1)),(0,o.Lk)("video",{ref_key:"remoteVideo",ref:d,autoplay:"",playsinline:""},null,512)])]),(0,o.Lk)("div",U,[n[2]||(n[2]=(0,o.Lk)("h3",null,"Debug Log",-1)),(0,o.Lk)("div",x,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(r.value,(e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n},(0,E.v_)(e),1))),128))])])]))}};const M=(0,p.A)(V,[["__scopeId","data-v-2f9f347e"]]);var N=M;a(2489);const W={class:"call-container"},X={class:"buttons"},F=["disabled"],H=["disabled"],q={class:"video-container"},J={class:"video-box"},z={class:"video-box"},Q={class:"messages"},B={class:"log-window"};var G={__name:"CallReceiver",setup(e){const n=(0,I.KR)(null),a=crypto.randomUUID(),t=(0,I.KR)(!1),c=(0,I.KR)(!1),l=(0,I.KR)(!1),i=(0,I.KR)("Disconnected"),r=(0,I.KR)("disconnected"),s=(0,I.KR)([]),d=(0,I.KR)(null),u=(0,I.KR)(null);let v=null,p=null,f=null,g=null,m=[];const y={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:turn.anyfirewall.com:443?transport=tcp",username:"webrtc",credential:"webrtc"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"};function k(e){const n=(new Date).toLocaleTimeString(),a=`[${n}] ${e}`;console.log("%c[WebRTC Receiver]","color:#28a745",e),s.value.push(a),s.value.length>500&&s.value.shift()}function C(e,n){i.value=e,r.value=n,k(`STATUS ‚Üí ${e}`)}function h(){const e=`ws://localhost:8080/connect/${a}`;k(`Connecting to signaling server: ${e}`),n.value=new WebSocket(e),n.value.onopen=()=>{t.value=!0,C("Connected to signaling server ‚úÖ","connected")},n.value.onmessage=async e=>{const n=JSON.parse(e.data);k(`Received: ${n.type}`),"offer"===n.type?(g=n,l.value=!0,C("Incoming call... üìû","waiting")):"ice-candidate"===n.type&&await w(n.candidate)},n.value.onclose=()=>{t.value=!1,C("Disconnected from signaling server","disconnected")},n.value.onerror=e=>{C("Signaling error ‚ùå","disconnected"),k(`WebSocket error: ${e.message}`)}}async function b(){if(g)try{k("Accepting call..."),c.value=!0,m=[];const t=await navigator.mediaDevices.enumerateDevices(),o=t.filter(e=>"videoinput"===e.kind),i=t.filter(e=>"audioinput"===e.kind);k(`Detected devices: ${o.length} cameras, ${i.length} microphones`);try{p=await navigator.mediaDevices.getUserMedia({video:!!o.length&&{width:{ideal:640},height:{ideal:480}},audio:!!i.length&&{echoCancellation:!0,noiseSuppression:!0}}),k("Local media stream acquired")}catch(e){k(`Primary getUserMedia failed (${e.name}): ${e.message}`);try{p=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),k("Fallback media stream acquired (basic config)")}catch(a){throw k(`Fallback getUserMedia failed (${a.name}): ${a.message}`),C("Media access failed ‚ùå","disconnected"),c.value=!1,a}}if(d.value.srcObject=p,v=new RTCPeerConnection(y),f=new MediaStream,u.value.srcObject=f,p.getTracks().forEach(e=>{v.addTrack(e,p),k(`Added local ${e.kind} track`)}),v.ontrack=e=>{k(`Remote track received: ${e.track.kind}`),e.streams&&e.streams[0]?u.value.srcObject=e.streams[0]:f.addTrack(e.track)},v.onicecandidate=e=>{e.candidate?(k(`ICE candidate: ${e.candidate.protocol}`),n.value.send(JSON.stringify({type:"ice-candidate",candidate:e.candidate}))):k("All ICE candidates sent")},v.onconnectionstatechange=()=>{k(`Connection state: ${v.connectionState}`),"connected"===v.connectionState?C("Call connected ‚úÖ","connected"):["failed","disconnected","closed"].includes(v.connectionState)&&(C(`Call ended (${v.connectionState})`,"disconnected"),c.value=!1)},k("Setting remote description (offer)..."),await v.setRemoteDescription(g),k("Remote description set"),m.length>0){k(`Processing ${m.length} queued ICE candidates`);for(const e of m)await v.addIceCandidate(e);m=[]}const r=await v.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});await v.setLocalDescription(r),n.value.send(JSON.stringify({type:"answer",sdp:r.sdp})),k("Answer sent to caller"),C("Call accepted ‚úÖ","connected"),l.value=!1}catch(e){k(`Failed to accept call: ${e.message}`),C("Call failed ‚ùå","disconnected"),c.value=!1}else alert("No offer received yet!")}async function w(e){if(v)try{v.remoteDescription?(await v.addIceCandidate(e),k("Added ICE candidate")):(m.push(e),k("Queued ICE candidate (remote not ready)"))}catch(n){k(`ICE candidate error: ${n.message}`)}else k("No PeerConnection for ICE candidate")}function L(){k("Hanging up..."),v&&v.close(),v=null,p&&(p.getTracks().forEach(e=>e.stop()),p=null),f&&(f.getTracks().forEach(e=>e.stop()),f=null),c.value=!1,g=null,m=[],C("Call ended","disconnected")}return(0,o.sV)(()=>{k(`Receiver mounted ‚Üí UUID: ${a}`),h()}),(0,o.xo)(()=>{L(),n.value&&n.value.close(),k("Receiver unmounted")}),(e,n)=>((0,o.uX)(),(0,o.CE)("div",W,[n[3]||(n[3]=(0,o.Lk)("h1",null,"WebRTC Video Receiver",-1)),(0,o.Lk)("div",{class:(0,E.C4)(["status",r.value])},(0,E.v_)(i.value),3),(0,o.Lk)("div",X,[(0,o.Lk)("button",{onClick:b,disabled:!l.value||c.value},"Accept Call",8,F),(0,o.Lk)("button",{onClick:L,disabled:!c.value},"Hang Up",8,H)]),(0,o.Lk)("div",q,[(0,o.Lk)("div",J,[n[0]||(n[0]=(0,o.Lk)("h3",null,"Local Video",-1)),(0,o.Lk)("video",{ref_key:"localVideo",ref:d,autoplay:"",muted:"",playsinline:""},null,512)]),(0,o.Lk)("div",z,[n[1]||(n[1]=(0,o.Lk)("h3",null,"Remote Video",-1)),(0,o.Lk)("video",{ref_key:"remoteVideo",ref:u,autoplay:"",playsinline:""},null,512)])]),(0,o.Lk)("div",Q,[n[2]||(n[2]=(0,o.Lk)("h3",null,"Debug Log",-1)),(0,o.Lk)("div",B,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(s.value,(e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n},(0,E.v_)(e),1))),128))])])]))}};const Y=(0,p.A)(G,[["__scopeId","data-v-7876a68a"]]);var Z=Y;const ee=[{path:"/",name:"Home",component:T},{path:"/call",name:"Call",component:N},{path:"/callee",name:"Callee",component:Z}],ne=(0,C.aE)({history:(0,C.LA)("/nofelet-ui/"),routes:ee});var ae=ne;console.log("üîß Router instance:",ae);const te=(0,t.Ef)(k);te.use(ae),te.mount("#app"),console.log("‚úÖ App mounted")}},n={};function a(t){var o=n[t];if(void 0!==o)return o.exports;var c=n[t]={exports:{}};return e[t].call(c.exports,c,c.exports,a),c.exports}a.m=e,function(){var e=[];a.O=function(n,t,o,c){if(!t){var l=1/0;for(d=0;d<e.length;d++){t=e[d][0],o=e[d][1],c=e[d][2];for(var i=!0,r=0;r<t.length;r++)(!1&c||l>=c)&&Object.keys(a.O).every(function(e){return a.O[e](t[r])})?t.splice(r--,1):(i=!1,c<l&&(l=c));if(i){e.splice(d--,1);var s=o();void 0!==s&&(n=s)}}return n}c=c||0;for(var d=e.length;d>0&&e[d-1][2]>c;d--)e[d]=e[d-1];e[d]=[t,o,c]}}(),function(){a.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(n,{a:n}),n}}(),function(){a.d=function(e,n){for(var t in n)a.o(n,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={524:0};a.O.j=function(n){return 0===e[n]};var n=function(n,t){var o,c,l=t[0],i=t[1],r=t[2],s=0;if(l.some(function(n){return 0!==e[n]})){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(r)var d=r(a)}for(n&&n(t);s<l.length;s++)c=l[s],a.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return a.O(d)},t=self["webpackChunknofelet"]=self["webpackChunknofelet"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var t=a.O(void 0,[504],function(){return a(1262)});t=a.O(t)})();
//# sourceMappingURL=app.57905b10.js.map